---
title: "inventario_script"
author: "Cesar"
date: "20/9/2019"
output: html_document
---
 
```{r}

#Se establecen las librerias
library(tidyverse)
library(lubridate)

#Convierte el archivo .csv en formato DATASET para ser usado en RStudio
i <- read_csv("C:/Users/G50/Desktop/Cesar' Shit/RecommenderSystem/Datasets_Originales/ORIGINAL_INVENTARIO.csv", locale = readr::locale(encoding = "latin1"))

#Convierte las columnas de dataset en caracteres en lugar de factores
#CU <- data.frame(lapply(CU, as.character), stringsAsFactors=FALSE)

#La mayoria de los ISBN consta de 13 digitos, entonces se cortan todos los valores antes del decimo tercer digito
i$ISBN <- str_sub(i$ISBN, end = 13)

#ISBN consta de numeros solamente, asi que se borran los caracteres
i$ISBN <- gsub("[a-z, A-Z, ?]*", "", i$ISBN)

#Se eliminan los caracteres especiales de la columna ISBN
i$ISBN <- gsub("[-, !, @, #, $, %, ^, &, , *, :, -, ., ;, /]", "", i$ISBN)

#Todo la columna de Actor princial tiene una "a" al principio, esta linea lo elimina
i$autorPrincipal <- gsub("^.{0,2}", "", i$autorPrincipal)

i$autorPrincipal
#Elimina numeros innecesarios, tales como a?os, etc...
i$autorPrincipal <- gsub("[0-9]*", "", i$autorPrincipal)

#Elimina caracteres especiales
i$autorPrincipal <- gsub("?", "", i$autorPrincipal)

#Elimina las comas, o puntos, son innecesarios
i$autorPrincipal <- gsub("[-, .]", " ", i$autorPrincipal)

#i$autorPrincipal <- gsub("NA", "", i$autorPrincipal)

#Todo la columna de Actor secundario tiene una "a" al principio, esta linea lo elimina
i$autorSecundario <- gsub("^.{0,2}", "", i$autorSecundario)


#Elimina numeros innecesarios, tales como a?os, etc...
i$autorSecundario <- gsub("[0-9]*", "", i$autorSecundario)

#Elimina caracteres especiales
i$autorSecundario <- gsub("?", "", i$autorSecundario)

#Elimina todos los caracteres especiales
i$autorSecundario <- gsub("[-, .]" , " " ,i$autorSecundario)

i$autorSecundario

#CU$autorSecundario <- gsub("NA", "", CU$autorSecundario)

# Elimina el primer caracter de cada columna
i$materia <- gsub("^.{0,2}", "", i$materia)

#Elimina los caracteres especiales
i$materia <- gsub("?", "", i$materia)
#CU$materia <- gsub("x", " ", CU$materia)

#Coloca la letra ? en donde corresponde
i$materia <- gsub("?n", "?", i$materia)

#Elimina los caracteres especiales
i$materia <- gsub("[-, !, @, #, $, %, ^, &, , *, :, -, ., ;, /]", " ", i$materia)

#Se crea una nueva columna a partir de los Autores principales y secundarios
i$autores <- paste(i$autorPrincipal, ",", i$autorSecundario)

# Se eliminan las 2 columnas
i$autorPrincipal <- NULL
i$autorSecundario <- NULL

i <- i[c("ISBN", "Titulo", "materia", "autores")]

#Se ordenan las columnas
i <- i[c(1,2,4, 3)]

i





i %>% glimpse()

#--------- Changing upper to lower case
i$Titulo <-tolower(i$Titulo)

i %>% glimpse()

#--------- Cleaning function
rm_accent <- function(str,pattern="all") {
   if(!is.character(str))
    str <- as.character(str)

  pattern <- unique(pattern)

  if(any(pattern=="?"))
    pattern[pattern=="?"] <- "?"

  symbols <- c(
    acute = "????????????",
    grave = "??????????",
    circunflex = "??????????",
    tilde = "??????",
    umlaut = "???????????",
    cedil = "??"
  )

  nudeSymbols <- c(
    acute = "aeiouAEIOUyY",
    grave = "aeiouAEIOU",
    circunflex = "aeiouAEIOU",
    tilde = "aoAOnN",
    umlaut = "aeiouAEIOUy",
    cedil = "cC"
  )

  accentTypes <- c("?","`","^","~","?","?")

  if(any(c("all","al","a","todos","t","to","tod","todo")%in%pattern)) # opcao retirar todos
    return(chartr(paste(symbols, collapse=""), paste(nudeSymbols, collapse=""), str))

  for(i in which(accentTypes%in%pattern))
    str <- chartr(symbols[i],nudeSymbols[i], str) 

  return(str)
}


rm_accent(i$Titulo)

#uacj_library %>% View()

#--------- Creating a column for language reference
i <- i %>% 
  mutate(language_reference = textcat(i$Titulo))

i %>% glimpse()  %>% View()

write.csv(i, file = "language_inventario.csv")

i %>% 
  filter(language_reference == "slovenian-iso8859_2") %>% View()

str(i$language_reference)

lang <- i %>% select(language_reference) %>% View()
lang <-  oBCC$language_reference <- as.factor(oBCC$language_reference)

levels(lang)

#write.csv(i, file = "inventario_clean.csv")

#i <- read_csv("C:/Users/G50/Desktop/RecommenderSystem/inventario.csv", locale = readr::locale(encoding = "latin1"))

#i%>% View()


  #Cambia la columna de idioma a SPANISH

  i$language_reference <- gsub("latin", "spanish", i$language_reference)
  i$language_reference <- gsub("romanian", "spanish", i$language_reference)
  i$language_reference <- gsub("catalan", "spanish", i$language_reference)
  i$language_reference <- gsub("rumantsch", "spanish", i$language_reference)
  i$language_reference <- gsub("portuguese", "spanish", i$language_reference)
  i$language_reference <- gsub("tagalog", "spanish", i$language_reference)
  i$language_reference <- gsub("basque", "spanish", i$language_reference)
  i$language_reference <- gsub("italian", "spanish", i$language_reference)
  i$language_reference <- gsub("swahili", "spanish", i$language_reference)
  i$language_reference <- gsub("esperanto", "spanish", i$language_reference)
  i$language_reference <- gsub("serbian-ascii", "spanish", i$language_reference)
  i$language_reference <- gsub("slovak-windows1250", "spanish", i$language_reference)
  i$language_reference <- gsub("bosnian", "spanish", i$language_reference)
  i$language_reference <- gsub("croatian-ascii", "spanish", i$language_reference)
  i$language_reference <- gsub("estonian", "spanish", i$language_reference)
  i$language_reference <- gsub("finnish", "spanish", i$language_reference)
  i$language_reference <- gsub("latvian", "spanish", i$language_reference)
  i$language_reference <- gsub("lithuanian", "spanish", i$language_reference)
  i$language_reference <- gsub("icelandic", "spanish", i$language_reference)
  i$language_reference <- gsub("norwegian", "spanish", i$language_reference)
  i$language_reference <- gsub("sanskrit", "spanish", i$language_reference)
  i$language_reference <- gsub("slovenian-iso8859_2", "spanish", i$language_reference)
  
  #Cambia la seccion idioma a ENGLISH
    i$language_reference <- gsub("middle_english", "english", i$language_reference)
    i$language_reference <- gsub("polish", "english", i$language_reference)
    i$language_reference <- gsub("scots_gaelic", "english", i$language_reference)
    i$language_reference <- gsub("swedish", "english", i$language_reference)
    i$language_reference <- gsub("slovak-ascii", "english", i$language_reference)
    i$language_reference <- gsub("frisian", "english", i$language_reference)
    i$language_reference <- gsub("manx", "english", i$language_reference)
    i$language_reference <- gsub("afrikaans", "english", i$language_reference)
    i$language_reference <- gsub("welsh", "english", i$language_reference)
    
    i$language_reference <- gsub("breton", "english", i$language_reference)
    i$language_reference <- gsub("danish", "english", i$language_reference)
    i$language_reference <- gsub("french", "english", i$language_reference)
    i$language_reference <- gsub("hungarian", "english", i$language_reference)
    i$language_reference <- gsub("irish", "english", i$language_reference)
    i$language_reference <- gsub("scots", "english", i$language_reference)
    
    spanish_i <- i %>% 
  filter(language_reference == "spanish")
    write.csv(spanish_i, "inventario_spanish.csv")
    
english_i <- i %>%
  filter(language_reference == "english")
    write.csv(english_i, "inventario_english.csv")
    
    
    
```



